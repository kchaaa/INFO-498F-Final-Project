---
title: "Flint Water Crisis"
output: html_document
runtime: shiny
---


```{r, echo=FALSE, message=FALSE, warning=FALSE}
#--------------------------------------------------------------#
# Flint, MI has a water problem. This dataset only deals with 271 households.

# Requires dplyr, library
library(dplyr)

# Import helper scripts.
source('scripts/help_find.r')
source('scripts/plot.r')

# Reads in the dataset.
data <- read.csv('data/Flint-Samples-FINAL.csv')
data <- data[-c(91),]

# Renames 3 of the columns to be more readable
colnames(data)[4] <- 'First_Draw'
colnames(data)[5] <- 'Flushing_45_Sec'
colnames(data)[6] <- 'Flushing_2_Min'

#--------------------------------------------------------------#
# This section finds the max levels of lead (ppb).

# Obtains the households with the highest level of lead (ppb) from the first sample.
max_first_draw <- data %>% 
                  filter(max(First_Draw) == First_Draw) %>% 
                  select(Ward, First_Draw)

# Obtains the households with the highest level of lead (ppb) from the sample 45 seconds after flushing.
max_45_sec <- data %>% 
              filter(max(Flushing_45_Sec) == Flushing_45_Sec) %>% 
              select(Ward, Flushing_45_Sec)

# Obtains the households with the highest level of lead (ppb) from the sample 2 minutes after flushing.
max_2_min <- data %>% 
             filter(max(Flushing_2_Min) == Flushing_2_Min) %>% 
             select(Ward, Flushing_2_Min)
#--------------------------------------------------------------#
# This section checks which households tested below worrisome level (0-5ppb)

# Obtains the households with ppb levels below the EPA allowed level (5ppb) for the first sample.
safe_first_draw <- data %>% 
                   filter(First_Draw < 5)
                   safe_first_num <- safe_first_draw %>% 
                   group_by(Ward) %>% summarise(First_Draw=sum(Ward==Ward))

# Obtains the households with ppb levels above the EPA allowed level (15ppb) for the sample 45 seconds after flushing.
safe_45_sec <- data %>% 
               filter(Flushing_45_Sec < 5)

safe_45sec_num <- safe_45_sec %>% 
                  group_by(Ward) %>% 
                  summarise(Flushing_45_Sec=sum(Ward==Ward))

# Obtains the households with ppb levels above the EPA allowed level (15ppb) for the sample 2 minutes after flushing.
safe_2_min <- data %>% 
              filter(Flushing_2_Min < 5)
              safe_2min_num <- safe_2_min %>% 
              group_by(Ward) %>% 
              summarise(Flushing_2_Min=sum(Ward==Ward))

# Combines the households that have high ppb levels for all 3 samples.
safe_levels <- inner_join(safe_2_min, safe_45_sec, by = c('SampleID', 'Zip.Code', 'Ward', 'First_Draw', 'Flushing_45_Sec', 'Flushing_2_Min', 'Notes'), copy=FALSE)

safe_levels <- inner_join(safe_levels, safe_first_draw, by = c('SampleID', 'Zip.Code', 'Ward', 'First_Draw', 'Flushing_45_Sec', 'Flushing_2_Min', 'Notes'), copy=FALSE)

safe_num <- left_join(safe_first_num, safe_45sec_num)

safe_num <- left_join(safe_num, safe_2min_num)

safe_num[is.na(safe_num)] <- 0

safe_num <- as.data.frame(safe_num)

#--------------------------------------------------------------#
# This section checks which households tested above the worrisome level of led (5ppb-15ppb).

# Obtains the households with ppb levels above the EPA allowed level (15ppb) for the first sample.
warning_first_draw <- data %>% 
                      filter(First_Draw > 5, First_Draw < 15)

warning_first_num <- warning_first_draw %>% 
                     group_by(Ward) %>% 
                     summarise(First_Draw=sum(Ward==Ward))

# Obtains the households with ppb levels above the EPA allowed level (15ppb) for the sample 45 seconds after flushing.
warning_45_sec <- data %>% 
                  filter(Flushing_45_Sec > 5, Flushing_45_Sec < 15)

warning_45sec_num <- warning_45_sec %>% 
                     group_by(Ward) %>% 
                     summarise(Flushing_45_Sec=sum(Ward==Ward))

# Obtains the households with ppb levels above the EPA allowed level (15ppb) for the sample 2 minutes after flushing.
warning_2_min <- data %>% 
                 filter(Flushing_2_Min > 5, Flushing_2_Min < 15)

warning_2min_num <- warning_2_min %>% 
                    group_by(Ward) %>% 
                    summarise(Flushing_2_Min=sum(Ward==Ward))

# Combines the households that have high ppb levels for all 3 samples.
warning_levels <- inner_join(warning_2_min, warning_45_sec, by = c('SampleID', 'Zip.Code', 'Ward', 'First_Draw', 'Flushing_45_Sec', 'Flushing_2_Min', 'Notes'), copy=FALSE)

warning_levels <- inner_join(warning_levels, warning_first_draw, by = c('SampleID', 'Zip.Code', 'Ward', 'First_Draw', 'Flushing_45_Sec', 'Flushing_2_Min', 'Notes'), copy=FALSE)

warning_num <- left_join(warning_first_num, warning_45sec_num)

warning_num <- left_join(warning_num, warning_2min_num)

warning_num[is.na(warning_num)] <- 0

warning_num <- as.data.frame(warning_num)

#--------------------------------------------------------------#
# This section checks which households tested above the EPA allowed level of led (15ppb). This is when action is necessary.

# Obtains the households with ppb levels above the EPA allowed level (15ppb) for the first sample.
above_epa_first_draw <- data %>% 
                        filter(First_Draw > 15)

above_first_num <- above_epa_first_draw %>% 
                   group_by(Ward) %>% 
                   summarise(First_Draw=sum(Ward==Ward))

# Obtains the households with ppb levels above the EPA allowed level (15ppb) for the sample 45 seconds after flushing.
above_epa_45_sec <- data %>% 
                    filter(Flushing_45_Sec > 15)

above_45sec_num <- above_epa_45_sec %>% 
                   group_by(Ward) %>% 
                   summarise(Flushing_45_Sec=sum(Ward==Ward))

# Obtains the households with ppb levels above the EPA allowed level (15ppb) for the sample 2 minutes after flushing.
above_epa_2_min <- data %>% 
                   filter(Flushing_2_Min > 15)

above_2min_num <- above_epa_2_min %>% 
                  group_by(Ward) %>% 
                  summarise(Flushing_2_Min=sum(Ward==Ward))

# Combines the households that have high ppb levels for all 3 samples.
above_epa <- inner_join(above_epa_2_min, above_epa_45_sec, by = c('SampleID', 'Zip.Code', 'Ward', 'First_Draw', 'Flushing_45_Sec', 'Flushing_2_Min', 'Notes'), copy=FALSE)

above_epa <- inner_join(above_epa, above_epa_first_draw, by = c('SampleID', 'Zip.Code', 'Ward', 'First_Draw', 'Flushing_45_Sec', 'Flushing_2_Min', 'Notes'), copy=FALSE)

above_num <- left_join(above_first_num, above_45sec_num)

above_num  <- left_join(above_num, above_2min_num)

above_num[is.na(above_num)] <- 0

above_num <- as.data.frame(above_num)

#--------------------------------------------------------------#
# This section tallies the numbers to compare.

# Initial number of samples.
num_initial <- nrow(data)

# Number of households with high ppb levels for first sample.
num_first_high_warning <- nrow(warning_first_draw)

# Number of households with standard or lower ppb levels as compared to the high ppb levels for the first sample.
num_first_low_warning<- num_initial - num_first_high_warning

# Number of households with high ppb levels for sample 45 seconds after flushing.
num_45_high_warning <- nrow(warning_45_sec)

# Number of households with high ppb levels for sample 2 minutes after flushing.
num_2_high_warning <- nrow(warning_2_min)

# Number of households that have high ppb levels for all 3 categories.
num_all_high_warning <- nrow(warning_levels)

# Number of households with dangerously high ppb levels for first sample.
num_first_high_danger <- nrow(above_epa_first_draw)

# Number of households with standard or lower ppb levels as compared to the dangerously high ppb levels for the first sample.
num_first_low_danger <- num_initial - num_first_high_danger

# Number of households with dangerously high ppb levels for sample 45 seconds after flushing.
num_45_high_danger <- nrow(above_epa_45_sec)

# Number of households with dangerously high ppb levels for sample 2 minutes after flushing.
num_2_high_danger <- nrow(above_epa_2_min)

# Number of households that have dangerously high ppb levels for all 3 categories.
num_all_high_danger <- nrow(above_epa)

#--------------------------------------------------------------#
# This section finds out which ward has the worst problem

# Which ward has the highest concentration of ppb levels.

# Checks the households in Ward 1
ward_1 <- data %>% 
          filter(Ward == 1)

ward_1_high <- ward_1 %>% 
               filter(First_Draw > 15 | Flushing_45_Sec > 15 | Flushing_2_Min > 15)

num_ward_1 <- nrow(ward_1_high)

# Checks the households in Ward 2
ward_2 <- data %>% 
          filter(Ward == 2)

ward_2_high <- ward_2 %>% 
               filter(First_Draw > 15 | Flushing_45_Sec > 15 | Flushing_2_Min > 15)

num_ward_2 <- nrow(ward_2_high)

# Checks the households in Ward 3
ward_3 <- data %>% 
          filter(Ward == 3)

ward_3_high <- ward_3 %>% 
               filter(First_Draw > 15 | Flushing_45_Sec > 15 | Flushing_2_Min > 15)

num_ward_3 <- nrow(ward_3_high)

# Checks the households in Ward 4
ward_4 <- data %>% 
          filter(Ward == 4)

ward_4_high <- ward_4 %>% 
               filter(First_Draw > 15 | Flushing_45_Sec > 15 | Flushing_2_Min > 15)

num_ward_4 <- nrow(ward_4_high)

# Checks the households in Ward 5
ward_5 <- data %>% 
         filter(Ward == 5)

ward_5_high <- ward_5 %>% 
               filter(First_Draw > 15 | Flushing_45_Sec > 15 | Flushing_2_Min > 15)

num_ward_5 <- nrow(ward_5_high)

# Checks the households in Ward 6
ward_6 <- data %>% 
          filter(Ward == 6)

ward_6_high <- ward_6 %>% 
              filter(First_Draw > 15 | Flushing_45_Sec > 15 | Flushing_2_Min > 15)

num_ward_6 <- nrow(ward_6_high)

# Checks the households in Ward 7
ward_7 <- data %>% 
          filter(Ward == 7)

ward_7_high <- ward_7 %>% 
               filter(First_Draw > 15 | Flushing_45_Sec > 15 | Flushing_2_Min > 15)

num_ward_7 <- nrow(ward_7_high)

# Checks the households in Ward 8
ward_8 <- data %>% 
          filter(Ward == 8)

ward_8_high <- ward_8 %>% 
              filter(First_Draw > 15 | Flushing_45_Sec > 15 | Flushing_2_Min > 15)

num_ward_8 <- nrow(ward_8_high)

# Checks the households in Ward 9
ward_9 <- data %>% 
          filter(Ward == 9)

ward_9_high <- ward_9 %>% 
               filter(First_Draw > 15 | Flushing_45_Sec > 15 | Flushing_2_Min > 15)

num_ward_9 <- nrow(ward_9_high)
```


![Flint Resident Protesting Water Conditions](http://assets.rollingstone.com/assets/2016/article/who-poisoned-flint-michigan-20160122/225359/large_rect/1453440373/1401x788-flint-opener.jpg)


**What is the Flint Water Crisis?**

The Flint Water Crisis is about how the residents of Flint have been suffering from lead-infected water.

**How Did This Happen?**

In April 2013, the Flint city council voted to join the Karegnondi Water Authority (KWA) that promised that they would get water from Lake Huron. This deal will save the city $19 million over eight years instead of continuing to pay Detroit for water. In response to Flint's decision, Detroit announced that they would stop providing Flint water in April 2014 even though the KWA won't be ready for another 3 years. Despite previous concerns about the conditions of the river, the emergency manager in Flint decided that they should use the Flint River as a backup water source. After using it, residents begin to notice and complain about the poor tasting and smelly water. The city found fecal coliform bacteria and recommended residents boil their water and buy bottled water.

**How Did the Government Respond?**

The government of Michigan and Flint worked to try to fix the water source; however, the state government refused to allow Flint to switch their water supply back to Detroit. Due to the government's effort, the city finally was able to improve the quality fo their water. Their celebration would be short because scientists soon found lead in the water due to old pipes and poor infrastructure. The State government promised to use $1 million to buy water filters for the city of Flint and finally allowed Flint to use Detroit water again. The government recommended they boil water as a way to clean their water, but boiling water results in higher lead concentration because a heavy metal like lead doesn't evaporate like water does. 

**What Are the Effects of Consuming Lead-Infected Water?**

The lead-infected water has serious health effects on the residents of Flint especially the children and pregnant women of Flint. It can affect growth their growth, behaviors, cognition, and hearing. Consuming lead-infected water can impact the residents' heart, kidneys, and nerves. There are medications that would reduce the amount of lead in their blood to reduce the negative effects of lead; however, no medication exist to treat for the adverse health effects. 

**How is the Test Conducted?**

A few months ago, a test was done in Flint. Three tests were conducted using the residents' toilets: 

1) the first draw, 

2) 45 seconds after flushing,  

3) 2 minutes after flushing. 

**What Do the Results of the Tests Mean?**

If the sample is below 5 ppb, the EPA deems this range as acceptable. 

If the sample is between 5 ppb and 14 ppb, then the water is relatively safe, but it is on the cusp of the danger. 

If the sample is 15 ppb or above, a range above the federal action level for lead, but can be treated by filters.

**What is ppb?**

Ppb stands for Parts Per Billion. It is the unit used to measure how much lead is in the water.

**What Does This Graph Show?**

As we can see, we can see the number of 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(shiny)
library(plotly)
names <- colnames(safe_num[2:4])
shinyApp(
  ui = fluidPage(
    titlePanel("Flint Water Contamination"),
    sidebarLayout(
      sidebarPanel(
        selectInput("choice", label = h3("Test Type"),
                    choices = names, selected = "First_Ward_Num")
      ),
      mainPanel(
        plotlyOutput("bar")
      )
    )
  ),
  #--
  server = function(input, output) {
    output$bar <- renderPlotly({
      stackbar(safe_num, warning_num, above_num, input$choice)
    })
  },
  options = list(height = 463)
  )
```

**What is a Ward?**

A ward is a district or section of a city. As we can see in the grpahic above, there are a total of 9 wards in Flint, MI. 

**Which Ward is in the Most Danger? Least Danger?**
 

# Map


